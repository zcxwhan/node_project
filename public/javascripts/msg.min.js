;(function (factory) {
    if (typeof define === "function" && define.amd) {
        // AMD模式
        define([ "jquery" ], factory);
    } else {
        // 全局模式
        factory(jQuery);
    }
}(function ($) {
	function Msg(json){
		this.init(json);
	}
	Msg.prototype={
		constructor:Msg,
		init:function(json){
			this.json=json;
			switch(json.type){
				case 0:this.easy(json);break;
				case 1:this.aler(json);break;
				case 3:this.confir(json);break;
			}
		},
		easy:function(json){
			var $div=$("<div></div>");
			$div.html(json.content);
			$("body").append($div);
			$div.css({
				"position":"fixed",
				"width":0,
				"height":0,
				"line-height":0,
				"text-align":"center",
				"left":$(window).width()/2,
				"top":$(window).height()/2,
				"background":"rgba(0,0,0,0.4)",
				"border-radius":"5px",
				"color":"#fff"
			}).stop().animate({
				"width":json.width,
				"height":json.height,
				"left":($(window).width()-json.width)/2,
				"top":($(window).height()-json.height)/2,
				"line-height":json.height+"px",
			},300,function(){
				setTimeout(function(){
					$div.stop().animate({
						"width":0,
						"height":0,
						"left":$(window).width()/2,
						"top":$(window).height()/2,
						"line-height":0
					},100,function(){
						$div.remove();
					});
				},1500);
			});
			
		},
		aler:function(json){
			if( json.mask ){
				var mask = $('<div></div>');
				mask.addClass('mask');
				$('body').append(mask);
				mask.fadeIn(200);
			}
			var $div=$("<div id="+json.id+"></div>");
			$div.html(json.content);
			$("body").append($div);
			$div.css({
				'position':'fixed',
				'left':($(window).width()-$div.width())/2,
				'top':($(window).height()-$div.height())/2,
				'display':'none'
			}).fadeIn(200);
		},
		confir:function(json){
			var that=this;
			// 遮罩层
			if( json.mask ){
				var mask = $('<div></div>');
				this.mask=mask;
				this.mask.addClass('mask').fadeIn();
				$('body').append(this.mask);
			}
			// 关闭按钮
			var close = $('<span>&times;</span>');
			close.click(function(){
				that.btn_close();
			}).addClass('close');
			// 标题
			var title = $('<h3></h3>');
			this.title=title;
			this.title.css({
				'height':'40px',
				'line-height':'40px'
			}).addClass('title').html(json.title).append(close);
			// 内容
			var content = $('<div></div>');
			content.addClass("content");
			// var h4=$("<h4>"+json.content+"</h4>");
			// content.append(h4);
			content.append(json.content)
			//确定按钮
			var btnSure=$("<a href='###'>确定</a>");
			btnSure.addClass("btnSure");
			content.append(btnSure);
			btnSure.click(function(){
				that.json.callback();
				//that.btn_close();
			});
			//取消按钮
			var btnClose=$("<a href='###'>取消</a>");
			btnClose.addClass("btnClose");
			content.append(btnClose);
			btnClose.click(function(){
				that.btn_close();
			});
			// 创建div窗口
			var win = $('<div></div>');
			this.win=win;
			this.win.addClass('win');
			this.win.append(this.title).append(content).attr({
				'name' : 'win'
			}).css({
				'width':json.width,
				'height':json.height,
				'left':($(window).width()-json.width)/2+$(document).scrollLeft(),
				'top':($(window).height()-json.height)/2+$(document).scrollTop(),
				'display':'none'
			}).fadeIn();
			
			$('body').append(this.win);
			// 拖拽
			this.title.on("mousedown",this.drag.bind(this));
		},
		btn_close:function(){
			var that=this;
			this.win.fadeOut(function(){
				that.win.remove();				
			});
			if( this.json.mask ){
				this.mask.fadeOut(function(){
					that.mask.remove();				
				});
			}
		},
		drag:function(e){
			var that=this;
			var x = e.clientX-that.win.offset().left;
			var y = e.clientY-that.win.offset().top;
			$(document).mousemove(function(e){
				var sx=e.clientX-x;
				var sy=e.clientY-y;
				// 边界处理
				var cw = $(window).width();
				var ch = $(window).height();
				// 滚动条
				var st = $(document).scrollTop();
				ch = ch+st;
				var sl = $(document).scrollLeft();
				cw = cw+sl;
				if(sx<sl)sx=sl;
				if(sx>cw-that.win.width())sx=cw-that.win.width();
				if(sy<st)sy=st;
				if(sy>ch-that.win.height())sy=ch-that.win.height(); 
				that.win.css({
					'left':sx,
					'top':sy
				});
			});
			$(document).mouseup(function(){
				$(document).unbind('mousemove');
				$(document).unbind('mouseup');
			});
			
		}
	}
	$.extend({
		msg:function(json){
			new Msg(json)
		}	
	});
}));



