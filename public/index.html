<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<link type="image/x-icon" href="/images/wb.ico" rel="shortcut icon">
		<link rel="stylesheet" href="/stylesheets/common.css" />
        <link rel="stylesheet" href="/stylesheets/iconfont.css" />
		<link rel="stylesheet" href="/stylesheets/list.css" />
		<link rel="stylesheet" href="/stylesheets/jquery.pagination.css" />
		<title>欢迎</title>
	</head>
	<body>
		
		<div id="header">
			<div class="header-con clearfix">
				<div class="header-conl">
					<a href="###"></span>买手表，上万表</a>
					<a href="###"><span class="iconfont icon-iconset0218"></span>【福利】下载APP,送终身手表保养及鉴证</a>
					
				</div>
				<ul class="header-conr">
					<ul>
						<li></li>
						<li><a href="###">我的订单</a></li>
						<li><a href="###" class="conr-a">万表APP</a><a href="###">办理信用卡</a><a href="###">服务专线</a></li>
						<li><a href="###">ENGLISH</a></li>
					</ul>
				</ul>
				<div class="header-conb">
					<div class="header-conbl">
						<img src="/images/logo1.png" alt="" />
						<img src="/images/logo2.png" alt="" />
					</div>
					<div class="header-conbr">
						<input type="text" name="" id="" value="" placeholder="搜索/品牌/系列/型号"/>
						<span class="iconfont icon-sousuo"></span>
						<em class="iconfont icon-gouwuche"></em>
					</div>
				</div>
			</div>
		</div>
		<div class="nav-con">
			<ul>
				<li><a href="">首页</a></li>
				<li><a href="">选表中心</a></li>
				<li><a href="">品牌馆</a></li>
				<li><a href="">闪购</a></li>
				<li><a href="">线下体验</a></li>
				<li><a href="">名将维修</a></li>
				<li><a href="">全球购表</a></li>
				<li><a href="">会员福利</a></li>
				<li><a href="">钟表文化</a></li>
			</ul>
			<div id="leftbanner"></div>	
		</div>
		<div id="nav-list">
			<div class="nav-list-con">
				<i>首页  > 商品中心</i>
				<strong>热门搜索：天梭力卢克   赫柏林</strong>
			</div>
		</div>

		<div class="content-con clearfix">
			<div class="content-left">
				<div id="smallBanner">
			
				</div>
			</div>
			<div class="content-right">
				<h2>
					<span>综合排序</span>
					<span>销量优先</span>
					<span>价格排序</span>
					<span>新品</span>
					<div class="pagetop">< <em>1</em> / <strong></strong> ></div>
				</h2>
				<ul class="content-list clearfix">
					
				</ul>
				<div class="box" style="margin-left:300px"></div>
			</div>
		</div>
		
		<div id="zheng">
			<div class="zheng-con">
				<ul>
					<li><span class="iconfont icon-zhengpinbaozhang"></span>正品保障</li>
					<li><span class="iconfont icon-mianfei"></span>免息分期</li>
					<li><span class="iconfont icon-zhengpinbaozhang"></span>全球联保</li>
					<li><span class="iconfont icon-mianfei"></span>假一赔三</li>
					<li><span class="iconfont icon-shouhou"></span>终身售后</li>
				</ul>
			</div>
		</div>
		<div id="footer">
			<div class="footer-con">
				<div class="top clearfix">
					<div class="topl">
						<div class="connect">
							<h4>客服电话:</h4>
							<h3>400-123-4567</h3>
							<p>外呼电话：010-1223456</p>
							<a href="">联系万表</a>
						</div>
						<ul>
							<li>
								新手指南
								<ol>
									<li>注册新会员</li>
									<li>购物流程</li>
									<li>手表小知识</li>
									<li>退货流程</li>
								</ol>
							</li>
							<li>
								支付
								<ol>
									<li>注册新会员</li>
									<li>购物流程</li>
									<li>手表小</li>
									<li>退货流程</li>
								</ol>
							</li>
							<li>
								注册
								<ol>
									<li>注册新会员</li>
									<li>购物流程</li>
									<li>手表小</li>
									<li>退货流程</li>
									<li>退货流程</li>
								</ol>
							</li>
							<li>
								服务中心
								<ol>
									<li>注册新会员</li>
									<li>购物流程</li>
									<li>手表小</li>
								</ol>
							</li>
							<li>
								万表保障
								<ol>
									<li>注册新会员</li>
									<li>购物流程</li>
									<li>手表小</li>
									<li>退货流程</li>
								</ol>
							</li>
						</ul>
					</div>
					<div class="topr">
						<li>
							<img src="/images/wb_weibo.png" alt="" />
							<p>万表微博</p>
						</li>
						<li>
							<img src="/images/wb_weixin.png" alt="" />
							<p>万表微信</p>
						</li>
					</div>
				</div>
				<hr style="width:100%;">
				<div class="bottom">
					<p>
						<a href="###">万表APP</a>
						<a href="###">万表全球购</a>
						<a href="###">万表</a>
						<a href="###">万表APP</a>
						<a href="###">万表APP</a>
						<a href="###">万表APP</a>
					</p>
					<ul>
						<li>万表网名表商城 版权所有 2008-2017 ICP备案证书号:粤ICP备09108738号 网监备案:4401060103141</li>
						<li>广州市万表科技股份有限公司 地址:广州市番禺区番禺大道北60-1号</li>
						<li>Copyright 2008-2017 WWW.WBIAO.CN.LTD ALL RIGHT RESERVED.</li>
					</ul>
					<div>
						<img src="/images/footer1.png" alt="" />
						<img src="/images/footer2.png" alt="" />
						<img src="/images/footer3.png" alt="" />
						<img src="/images/footer4.png" alt="" />
					</div>
					<p><a href="###">联系qq</a><a href="###">联系qq</a><a href="###">联系qq</a><a href="###">联系qq</a><a href="###">联系qq</a></p>
				</div>
			</div>
		</div>
		<!-- 头像 -->
		<div id="touxiang"></div>
    </body>
    <script src="javascripts/jquery.min.js"></script>
	<script src="javascripts/cookie.min.js"></script>
	<script src="javascripts/jquery.pagination.min.js"></script>
	<script src="javascripts/msg.min.js"></script>
    <script>
        $(function(){
            var options={
                url:'/confirm',
                method:'get'
            }
            $.ajax(options).then(function(res){
                res=JSON.parse(res);
                if(res.tocken==true){
					var con=res.username;
					$("#touxiang").html("");
					$("#touxiang").append($('<img class="tou" src=/uploads/'+con+'.jpg>'));
					$("#touxiang").append($('<img class="tou" src=/uploads/'+con+'.png>'));
					$('.tou').on("error",function(){
						$(this).remove();
					});
					$('#touxiang').css({
						"position":"fixed",
						"left":"30px",
						"top":"130px"
					});

                    $(".header-conr").find('li').eq(0).html("您好! "+con+" 欢迎光临万表网	 "+"<strong>退出</strong>");
                    var exit=$(".header-conr").find('strong');
                    exit.on("click",function(){
                        $(".header-conr").find('li').eq(0).html("");
                        var $alogin=$("<a href='/login'>登录</a>");
                        var $areg=$("<a href='/register'>注册</a>");
                        $(".header-conr").find('li').eq(0).append($alogin).append($areg);
                        unsetCookie("WBID");
					});
					//头像上传
					$(".header-conl").append('<input type="file" id="file" style="width:120px;" name="file"><a href="" id="uploadimg" style="color:red;">头像上传</a>')
					$('#uploadimg').on("click",function(){
						var file = $("#file").get(0);
						var formData = new FormData();
						if(file.files[0]==undefined){
							alert("请选择文件");
						}else if(!/(.png)|(.jpg)/.test(file.files[0].name)){
							alert("图片只能是jpg或者png");
						}else{
							formData.append("file1",file.files[0]);

							var options = {
								url:"/upload",
								type:"post",
								data:formData ,
								contentType: false,//为了让浏览器根据传入的formdata来判断contentType
								processData: false//同上
							}
							$.ajax(options)
							.then(function(res){
								 if(res.data){
									 alert("上传成功了。。");
									 $("#touxiang").html("");
									 $("#touxiang").append($('<img class="tou" src='+res.data+'>'));
									 $('#touxiang').css({
										 "position":"fixed",
										 "left":"30px",
										 "top":"130px"
									 });
									// location.reload();
								 }
							});
            			}
						return false;
					});
                }else{
                    var $alogin=$("<a href='/login'>登录</a>");
                    var $areg=$("<a href='/register'>注册</a>");
                    $(".header-conr").find('li').eq(0).append($alogin).append($areg);
	            }
			});

			//加载列表数据 分页
			function Pagination(url){
                if(!url) throw  new Error().message = "请传入url参数";
                this.options = {
                    url:url,
                    data:null
                }
                this.init();
            } 

            Pagination.prototype = {
                constructor: Pagination,
                init:function(){
                    this.load_json();
                },
                add_event:function(dom){
                    var _this = this;
                    dom.on("click","a",function(){
						$.msg({
							type:1,
							mask:true,
							id:"loading-box",
							"content":"数据加载中..."
						});
						 _this.options = $.extend(_this.options,{data:{page:parseInt($(this).attr("data-current"))-1}});
						 $(".pagetop em").html($(this).attr("data-current"));//更新上面页码
                         _this.load_json.call(_this);
                    });
                },
                load_json:function(){
                    $.ajax(this.options)
                    .done($.proxy(this.render_page,this))
                    .fail(this.error)
                },
                render_page:function(res){
                    if (res.data.length == 0) return 0;
					var $ul=$(".content-list");
					$ul.html("");
                    res.data.forEach(function(val,index){
						var $li=$("<li></li>");
						$li.addClass("listli");
						$li=$li;
						//img
						var $img=$("<img>");
						$img.attr("src",val.src);
						$li.append($img);
						//价格
						var $span=$("<span></span>");
						$span.html("&yen;"+val.id);
						$li.append($span);
						//销量
						var $strong=$("<strong></strong>");
						$strong.html("销量 "+val.sailnum);
						$li.append($strong);
						//描述
						var $h3=$("<h3></h3>");
						$h3.html(val.des);
						$li.append($h3);
						//加入收藏  购物车
						var $a1=$("<a href='###'>加入收藏</a>");
						var $a2=$('<a href="###">加入购物车</a>');
						$a2.addClass("addShop");
						$li.append($a1);
						$li.append($a2);
						$ul.append($li);
					});
					if($(".box").html()==""){
						$(".box").pagination({
							currentPage:1,
							totalPage:parseInt(res.allp)
						});
						var _this=this;
                    	setTimeout(() => {
							_this.add_event($('.box'));
							$(".pagetop strong").html(res.allp);
                    	}, 0);
					}else{
						setTimeout(() => {
							$("#loading-box").remove();
							$(".mask").remove();
							$("html").animate({
								"scroll-top":$(".content-con").offset().top
							});	
						}, 200);
					}
					
                    
                   
                },
                error:function(err){
                    console.log(err.state);
                }
            }
            new Pagination("http://10.9.153.180:3000/goods/list");
			
        });
    </script>
</html>
